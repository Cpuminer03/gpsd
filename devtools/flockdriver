#!/bin/sh
#
# flockdriver - conduct regression tests as an argent for a remote flocktest
#
# usage: flockdriver -d gitname -m mailto
#
# The -d argument must be a subdirectory name
# The -m option must be a valid address for notification mail.
#
#  This will perform the following steps:
#
#  * If required, create the origin repo in a directory named after 
#     you beneath the test account home,
#
#   * git pull and build in that repo.
#
#   * make check, capturing the output
#
#   * mail the output back to you.
#
while getopts dm opt
do
    case $opt in
        d) subdir=$2; shift; shift ;;
	m) mailto=$2; shift; shift ;;
    esac
done

# Should yield a git URL valid for read-only access
origin="git://git.berlios.de/gpsd"

echo "Site: `hostname --fqdn`" 
echo "  subdir: $subdir"
echo "  mailto: $mailto"
echo "  clone-url: $origin"
echo "  here: $PWD"

# Set up or update the repo
if [ ! -d $subdir ]
then
    mkdir $subdir
    git clone $origin $subdir
else
    cd $subdir; git pull
fi

# End.
