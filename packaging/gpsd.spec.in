%define pkgconfig_version 0.12

Name: gpsd
Summary: Service daemon for mediating access to a GPS
Version: @VERSION@
Release: 1
License: BSD
Group: System Environment/Daemons
URL: http://developer.berlios.de/projects/gpsd/
Source0: %{name}-%{version}.tar.gz
BuildRequires: ncurses-devel gcc libxslt python
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
Prereq: /sbin/chkconfig
#Destinations: mailto:gpsd-announce@lists.berlios.de, mailto:gpsd-users@lists.berlios.de, mailto:gpsd-dev@lists.berlios.de

%description 
gpsd is a service daemon that mediates access to a GPS sensor
connected to the host computer by serial or USB interface, making its
data on the location/course/velocity of the sensor available to be
queried on TCP port 2947 of the host computer.  With gpsd, multiple
GPS client applications (such as navigational and wardriving software)
can share access to a GPS without contention or loss of data.  Also,
gpsd responds to queries with a format that is substantially easier to
parse than NMEA 0183.  A client library is provided for applications.

After installing this RPM, gpsd will automatically connect to USB
GPSes when they are plugged in and requires no configuration.  For
serial GPSes, you will need to start gpsd by hand.  Once connected,
the daemon automatically discovers the correct baudrate, stop bits,
and protocol. The daemon will be quiescent when there are no
clients asking for location information, and copes gracefully when the
GPS is unplugged and replugged.

%package devel
Summary: Client libraries in C and Python for talking to a running gpsd or GPS
Group: Development/Libraries
BuildRequires: pkgconfig >= %{pkgconfig_version}
Requires: gpsd

%description devel
This package provides C header files for the gpsd shared libraries
that manage access to a GPS for applications; also Python modules.
You will need to have gpsd installed for it to work.

%package clients
Summary: Clients for gpsd with an X interface
Group: Applications/System
BuildRequires: pygtk
BuildRequires: libXaw-devel

%description clients
xgps is a simple test client for gpsd with an X interface. It displays
current GPS position/time/velocity information and (for GPSes that
support the feature) the locations of accessible satellites.

xgpsspeed is a speedometer that uses position information from the GPS.
It accepts an -h option and optional argument as for gps, or a -V option
to dump the package version and exit. Additionally, it accepts -rv
(reverse video) and -nc (needle color) options.

cgps resembles xgps, but without the pictorial satellite display.  It
can run on a serial terminal or terminal emulator.
%prep
%setup -q

%build
###########################################################################
#                                                                         #
#  Append configure options to the ./autogen.sh script command line       #
#  Examples:                                                              #
#      ./autogen.sh --disable-earthmate                                   #
#      ./autogen.sh --disable-reconfigure                                 #
#                                                                         #
###########################################################################
./autogen.sh LDFLAGS=-s
make %{?_smp_mflags}

%install
[ "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf "$RPM_BUILD_ROOT"
%makeinstall
# additional gpsd files
mkdir -p "$RPM_BUILD_ROOT"%{_libdir}/X11/app-defaults/
cp xgps.ad "$RPM_BUILD_ROOT"%{_libdir}/X11/app-defaults/xgps
cp xgpsspeed.ad "$RPM_BUILD_ROOT"%{_libdir}/X11/app-defaults/xgpsspeed
mkdir -p "$RPM_BUILD_ROOT"%{_sysconfdir}/hotplug/usb
cp gpsd.hotplug gpsd.usermap "$RPM_BUILD_ROOT"%{_sysconfdir}/hotplug/usb/
mkdir -p "$RPM_BUILD_ROOT"/etc/rc.d/init.d
cp packaging/etc_init.d_gpsd_rpm "$RPM_BUILD_ROOT"/etc/rc.d/init.d/gpsd

%clean
[ "$RPM_BUILD_ROOT" -a "$RPM_BUILD_ROOT" != / ] && rm -rf "$RPM_BUILD_ROOT"

%post -n gpsd
/sbin/ldconfig

%postun -n gpsd
/sbin/ldconfig

# /usr/lib/python* has to be wired in below because the autoconf-generated 
# Python installation production drops Python stuff in /usr/lib even on a
# 64-bit system, where ${_libdir} will expand to /usr/lib64.

%files
%defattr(-,root,root,-)
%doc README INSTALL COPYING
%attr(755, root, root) %{_sbindir}/gpsd
%attr(755, root, root) %{_bindir}/gpsctl
%attr(755, root, root) %{_bindir}/lcdgps
%attr(755, root, root) %{_bindir}/gpsprof
%attr(755, root, root) %{_bindir}/gpsmon
%{_libdir}/libgps.la
%{_libdir}/libgps.so*
%{_libdir}/libgps.a
%{_libdir}/libgpsd.la
%{_libdir}/libgpsd.so*
%{_libdir}/libgpsd.a
%{_mandir}/man8/gpsd.8*
%{_mandir}/man1/gpsprof.1*
%{_mandir}/man1/gpsmon.1*
%{_mandir}/man1/gpsctl.1*
%{_sysconfdir}/hotplug/usb/gpsd.hotplug
%{_sysconfdir}/hotplug/usb/gpsd.usermap
%attr(755, root, root) /etc/rc.d/init.d/gpsd
%attr(755, root, root) /usr/lib/python*/site-packages/gps/*
%attr(755, root, root) /usr/lib/python*/site-packages/gpscap.py*
#%{_datadir}/gpsd/dgpsip-servers

%files devel
%defattr(-,root,root,-)
%doc README INSTALL COPYING TODO
%attr(755, root, root) %{_bindir}/gpscat
%attr(755, root, root) %{_bindir}/gpsfake
%attr(755, root, root) %{_bindir}/gpsdecode
%{_includedir}/gps.h
%{_includedir}/libgpsmm.h
%{_includedir}/gpsd.h
%{_mandir}/man1/gpscat.1*
%{_mandir}/man1/gpsfake.1*
%{_mandir}/man1/gpsdecode.1*
%{_mandir}/man1/lcdgps.1*
%{_mandir}/man3/libgps.3*
%{_mandir}/man3/libgpsmm.3*
%{_mandir}/man3/libgpsd.3*
%{_mandir}/man5/rtcm-104.5*
%{_mandir}/man5/srec.5*
%{_libdir}/pkgconfig/*

%files clients
%defattr(-,root,root,-)
%attr(755, root, root) %{_bindir}/xgps
%attr(755, root, root) %{_bindir}/xgpsspeed
%attr(755, root, root) %{_bindir}/cgps
%attr(755, root, root) %{_bindir}/gpspipe
%attr(755, root, root) %{_bindir}/gpxlogger
%{_mandir}/man1/gps.1*
%{_mandir}/man1/cgps.1*
%{_mandir}/man1/xgps.1*
%{_mandir}/man1/xgpsspeed.1*
%{_mandir}/man1/gpspipe.1*
%{_libdir}/X11/app-defaults/xgps
%{_libdir}/X11/app-defaults/xgpsspeed

%changelog
* Tue Mar 10 2009 Michael R. Davis <mrdvt92> - 2.39dev
- dropped gpsdclient.h from packaging
* Sun Mar 8 2009 Michael R. Davis <mrdvt92> - 2.39dev
- changed gpsdlcdd to lcdgps, sirfmon to gpsmon, cgpxlogger to gpxlogger
  added gpsdclient.h to devel package
* Sat Feb 7 2009 Michael R. Davis <mrdvt92> - 2.38 RC4
- Added gpsdlcdd, gpscap.py*, gpslib.so, init.d/gpsd

# The following sets edit modes for GNU EMACS
# Local Variables:
# mode:rpm-spec
# End:
